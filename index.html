<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> ‚ùÑÔ∏è Snowfall Effect ‚Äî Demo</title>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Arial; min-height: 100vh; background: linear-gradient(#020911, #03051a); color: #fff; }
    .controls { position: fixed; right: 12px; top: 12px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 8px; }
    .content { padding: 64px; }
    h1 { margin: 0 0 8px 0; }
  </style>
</head>
<body>
  <div class="content">
    <h1> ‚ùÑÔ∏è Snowfall Effect ‚Äî Demo</h1>
    <p> üå≤üéÑ‚òÉÔ∏è Example of integrating a simple falling snow effect into a web page.</p>
    <p> Repo: <a href="https://github.com/waveswan/snowfall-effect/" target="_blank" rel="noopener" style="color:#cfe6ff">github.com/waveswan/snowfall-effect</a></p>
  </div>

  <div style="position:fixed;left:12px;bottom:12px;color:rgba(255,255,255,0.9);font-size:13px;">
    Author: <a href="https://github.com/waveswan/" target="_blank" rel="noopener" style="color:#cfe6ff">github.com/waveswan</a>
  </div>

  <div class="controls">
    <div style="display:flex;flex-direction:column;gap:6px;min-width:220px;padding:10px;">
      <label>Snowflake count: <input id="cfg-snowflakeCount" type="number" min="0" step="1" value="250" /></label>
      <label>Color: <input id="cfg-color" type="color" value="#dee4fd" /></label>
      <label>Radius min: <input id="cfg-radius-min" type="number" step="0.1" value="0.5" /></label>
      <label>Radius max: <input id="cfg-radius-max" type="number" step="0.1" value="1.6" /></label>
      <label>Speed min: <input id="cfg-speed-min" type="number" step="0.1" value="0.5" /></label>
      <label>Speed max: <input id="cfg-speed-max" type="number" step="0.1" value="2" /></label>
      <label>Wind min: <input id="cfg-wind-min" type="number" step="0.1" value="-0.5" /></label>
      <label>Wind max: <input id="cfg-wind-max" type="number" step="0.1" value="4" /></label>
      <label>Change frequency (frames): <input id="cfg-changeFrequency" type="number" step="1" value="250" /></label>
      <label>Opacity min: <input id="cfg-opacity-min" type="number" step="0.1" value="1" /></label>
      <label>Opacity max: <input id="cfg-opacity-max" type="number" step="0.1" value="1" /></label>
        <label>Z-index: <input id="cfg-zindex" type="number" step="1" value="99999" /></label>
        <label>Insert after element id (anchor): <input id="cfg-anchor-id" type="text" placeholder="optional id" /></label>
      <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
        <button id="preset-snow">Snow</button>
        <button id="preset-rain">Rain</button>
        <button id="preset-fire">Fire</button>
        <button id="preset-embers">Embers</button>
      </div>
      <div style="display:flex;gap:6px;margin-top:12px;">
        <button id="toggle">Pause</button>
        <button id="reset">Reset</button>
        <button id="destroy">Destroy</button>
      </div>
      <div style="margin-top:12px;">
        <label style="font-size:13px;display:block;margin-bottom:6px;color:#cfe6ff">Copy integration snippet</label>
        <div style="display:flex;gap:6px;align-items:flex-start;">
          <pre id="code-snippet" style="white-space:pre-wrap;flex:1;padding:8px;background:rgba(0,0,0,0.35);border-radius:6px;font-size:12px;overflow:auto;margin:0;height:120px;"></pre>
          <div style="display:flex;flex-direction:column;gap:6px;">
            <button id="copy-snippet">Copy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createSnowfall } from './snowfall-effect.js';

    let snowfall = createSnowfall({
      snowflakeCount: 250,
      color: '#dee4fd',
      radius: [0.5, 1.6],
      speed: [0.5, 2],
      wind: [-0.5, 4],
      changeFrequency: 250,
      zIndex: 99999,
      anchorId: null
    });

    window.snowfall = snowfall;

    const toggle = document.getElementById('toggle');
    const destroy = document.getElementById('destroy');
    const reset = document.getElementById('reset');

    function readConfigFromForm() {
      return {
        snowflakeCount: Number(document.getElementById('cfg-snowflakeCount').value) || 0,
        color: document.getElementById('cfg-color').value,
        radius: [Number(document.getElementById('cfg-radius-min').value), Number(document.getElementById('cfg-radius-max').value)],
        speed: [Number(document.getElementById('cfg-speed-min').value), Number(document.getElementById('cfg-speed-max').value)],
        wind: [Number(document.getElementById('cfg-wind-min').value), Number(document.getElementById('cfg-wind-max').value)],
        changeFrequency: Number(document.getElementById('cfg-changeFrequency').value) || 200,
          opacity: [Number(document.getElementById('cfg-opacity-min').value), Number(document.getElementById('cfg-opacity-max').value)],
          zIndex: Number(document.getElementById('cfg-zindex').value) || 99999,
          anchorId: document.getElementById('cfg-anchor-id').value || null
      };
    }

    // live update on inputs: recreate instance to ensure all params apply immediately
    function applyConfigLive() {
      const cfg = readConfigFromForm();
      // destroy and recreate with current config
      try { snowfall.destroy(); } catch (e) {}
      snowfall = createSnowfall(cfg);
      window.snowfall = snowfall;
      toggle.textContent = 'Pause';
      updateSnippet(cfg);
    }

    document.querySelectorAll('.controls input').forEach(i => {
      i.addEventListener('input', () => applyConfigLive());
    });

    // also update on change events
    document.querySelectorAll('.controls input').forEach(i => i.addEventListener('change', () => applyConfigLive()));

    // keep currentAnchor for optional logic
    let currentAnchor = null;

    reset.addEventListener('click', () => {
      const cfg = readConfigFromForm();
      // apply defaults and recreate
      try { snowfall.destroy(); } catch (e) {}
      snowfall = createSnowfall(cfg);
      window.snowfall = snowfall;
      updateSnippet(cfg);
    });

    toggle.addEventListener('click', () => {
      if (snowfall.animationFrame) {
        snowfall.pause();
        toggle.textContent = 'Play';
      } else {
        snowfall.play();
        toggle.textContent = 'Pause';
      }
    });

    destroy.addEventListener('click', () => {
      try { snowfall.destroy(); } catch (e) {}
      const cfg2 = readConfigFromForm();
      snowfall = createSnowfall(cfg2);
      window.snowfall = snowfall;
      toggle.textContent = 'Pause';
      updateSnippet(cfg2);
    });

    // Preset definitions map
    const PRESETS = {
      snow: {
        snowflakeCount: 250,
        color: '#dee4fd',
        radius: [0.5, 1.6],
        speed: [0.5, 2],
        wind: [-0.5, 4],
        changeFrequency: 250,
        opacity: [1, 1],
        zIndex: 99999,
        anchorId: null
      },
      rain: {
        snowflakeCount: 1000,
        color: '#9ec6ff',
        radius: [0.5, 0.7],
        speed: [6, 26],
        wind: [-0.1, 0],
        changeFrequency: 250,
        opacity: [0.2, 0.6],
        zIndex: 99999,
        anchorId: null
      },
      fire: {
        snowflakeCount: 600,
        color: '#ff4b2b',
        radius: [0.2, 1.2],
        speed: [2, 8],
        wind: [-0.2, 0.2],
        changeFrequency: 200,
        opacity: [0.4, 0.95],
        zIndex: 99999,
        anchorId: null
      },
      embers: {
        snowflakeCount: 400,
        color: '#ffb66b',
        radius: [0.1, 0.7],
        speed: [3, 12],
        wind: [-0.3, 0.3],
        changeFrequency: 220,
        opacity: [0.35, 0.9],
        zIndex: 99999,
        anchorId: null
      }
    };

    // Generic helper to set input value if element exists
    function setIf(id, value) {
      const el = document.getElementById(id);
      if (!el) return;
      el.value = value == null ? '' : String(value);
    }

    // Apply preset by name (parses ranges and simple keys)
    function applyPreset(name) {
      const preset = PRESETS[name];
      if (!preset) return;
      const rangeKeys = ['radius', 'speed', 'wind', 'opacity'];
      for (const [k, v] of Object.entries(preset)) {
        if (rangeKeys.includes(k) && Array.isArray(v)) {
          setIf(`cfg-${k}-min`, v[0]);
          setIf(`cfg-${k}-max`, v[1]);
        } else if (k === 'snowflakeCount') {
          setIf('cfg-snowflakeCount', v);
        } else if (k === 'color') {
          setIf('cfg-color', v);
        } else if (k === 'changeFrequency') {
          setIf('cfg-changeFrequency', v);
        } else if (k === 'zIndex') {
          setIf('cfg-zindex', v);
        } else if (k === 'anchorId') {
          setIf('cfg-anchor-id', v || '');
        } else {
          // fallback: try direct cfg-<key>
          setIf(`cfg-${k}`, v);
        }
      }
      applyConfigLive();
    }

    // wire preset buttons to generic handler
    document.getElementById('preset-snow').addEventListener('click', () => applyPreset('snow'));
    document.getElementById('preset-rain').addEventListener('click', () => applyPreset('rain'));
    document.getElementById('preset-fire').addEventListener('click', () => applyPreset('fire'));
    document.getElementById('preset-embers').addEventListener('click', () => applyPreset('embers'));

    // Code snippet generation & copy
    function updateSnippet(cfg) {
      const parts = [];
      parts.push('import { createSnowfall } from "./snowfall-effect.js";');
      parts.push('');
      parts.push('const snowfall = createSnowfall({');
      parts.push(`  snowflakeCount: ${cfg.snowflakeCount},`);
      parts.push(`  color: '${cfg.color}',`);
      parts.push(`  radius: [${cfg.radius[0]}, ${cfg.radius[1]}],`);
      parts.push(`  speed: [${cfg.speed[0]}, ${cfg.speed[1]}],`);
      parts.push(`  wind: [${cfg.wind[0]}, ${cfg.wind[1]}],`);
      parts.push(`  changeFrequency: ${cfg.changeFrequency},`);
      parts.push(`  opacity: [${cfg.opacity[0]}, ${cfg.opacity[1]}],`);
      if (cfg.zIndex !== undefined) parts.push(`  zIndex: ${cfg.zIndex},`);
      if (cfg.anchorId) parts.push(`  anchorId: '${cfg.anchorId}',`);
      parts.push('});');
      document.getElementById('code-snippet').textContent = parts.join('\n');
    }

    function copySnippet() {
      const text = document.getElementById('code-snippet').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const b = document.getElementById('copy-snippet');
        b.textContent = 'Copied!';
        setTimeout(() => b.textContent = 'Copy', 1200);
      });
    }

    document.getElementById('copy-snippet').addEventListener('click', copySnippet);

    // initialize snippet
    updateSnippet(readConfigFromForm());
  </script>
</body>
</html>
