<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>❄️ Snowfall Effect — Demo</title>
  <style>
    :root{--panel:rgba(0,0,0,0.45);--accent:#cfe6ff}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Arial;background:linear-gradient(#020911,#03051a);color:#fff;min-height:100vh}
    .content{padding:28px 20px 120px}
    h1{margin:0 0 8px}
    .meta{color:#cfe6ff;margin-bottom:18px}
    .controls{position:fixed;right:12px;top:12px;background:var(--panel);padding:12px;border-radius:10px;width:260px;max-height:80vh;overflow:auto}
    .controls label{display:block;font-size:13px;margin-bottom:8px}
    .controls input,.controls select{box-sizing:border-box;padding:6px;border-radius:6px;border:0;background:rgba(255,255,255,0.04);color:#fff}
    .controls input[type="color"]{height:40px;padding:6px}
    .controls .presets{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
    .controls button{padding:8px 10px;background:#133046;color:var(--accent);border:0;border-radius:8px;cursor:pointer}
    pre#code-snippet{background:rgba(0,0,0,0.35);padding:8px;border-radius:6px;font-size:12px;color:#eef;max-height:120px;overflow:auto}

    /* Mobile adjustments: collapse form controls, show only compact UI */
    @media (max-width:720px){
      .controls{left:8px;right:8px;top:auto;bottom:8px;width:auto;display:block;padding:8px;max-height:40vh}
      .controls label:not(.keep){display:none}
      .controls input:not(.keep), .controls select:not(.keep), pre#code-snippet{display:none}
      .controls .presets{display:flex;gap:6px;justify-content:space-between}
    }
  </style>
</head>
<body>
    <main class="content">
    <h1>❄️ Snowfall Effect — Demo</h1>
    <p class="meta">Example integration of the particle effect. Repository: <a href="https://github.com/waveswan/snowfall-effect/" target="_blank" rel="noopener" style="color:#cfe6ff">github.com/waveswan/snowfall-effect</a></p>
    <p style="max-width:720px;color:#d6e8ff;line-height:1.4">Use presets, edit parameters, and copy the snippet to paste into your project. On mobile devices the UI is automatically simplified to save battery.</p>
  </main>

  <aside class="controls" aria-label="Controls">
    <label class="keep">Snowflake count: <input id="cfg-snowflakeCount" type="number" min="0" step="1" value="250" class="keep"/></label>
    <label class="keep">Color: <input id="cfg-color" type="color" value="#dee4fd" class="keep"/></label>
    <label>Radius min: <input id="cfg-radius-min" type="number" step="0.1" value="0.5" /></label>
    <label>Radius max: <input id="cfg-radius-max" type="number" step="0.1" value="1.6" /></label>
    <label>Speed min: <input id="cfg-speed-min" type="number" step="0.1" value="0.5" /></label>
    <label>Speed max: <input id="cfg-speed-max" type="number" step="0.1" value="2" /></label>
    <label>Wind min: <input id="cfg-wind-min" type="number" step="0.1" value="-0.5" /></label>
    <label>Wind max: <input id="cfg-wind-max" type="number" step="0.1" value="4" /></label>
    <label>Change frequency (frames): <input id="cfg-changeFrequency" type="number" step="1" value="250" /></label>
    <label>Opacity min: <input id="cfg-opacity-min" type="number" step="0.1" value="1" /></label>
    <label>Opacity max: <input id="cfg-opacity-max" type="number" step="0.1" value="1" /></label>
    <label>Z-index: <input id="cfg-zindex" type="number" step="1" value="99999" /></label>
    <label>Insert after element id (anchor): <input id="cfg-anchor-id" type="text" placeholder="optional id" /></label>
    <label>Direction: <select id="cfg-direction"><option value="down">down</option><option value="up">up</option></select></label>

    <div class="presets" style="margin-top:8px">
      <button id="preset-snow">Snow</button>
      <button id="preset-fireflies">Fireflies</button>
      <button id="preset-matrix">Matrix</button>
      <button id="preset-fire">Fire</button>
      <button id="preset-rain">Rain</button>
    </div>

    <div style="display:flex;gap:8px;margin-top:20px">
      <button id="toggle">Pause</button>
      <button id="reset">Reset</button>
      <button id="destroy">Restart</button>
      <button id="copy-snippet" style="margin-left:auto">Copy Snippet</button>
    </div>

    <div style="margin-top:12px;">
      <pre id="code-snippet"></pre>
    </div>
  </aside>

  <script type="module">
    import { createSnowfall } from './snowfall-effect.js';

    // Presets (desktop values)
    const PRESETS = {
      snow: {
        snowflakeCount: 250,
        color: '#dee4fd',
        radius: [0.5, 1.6],
        speed: [0.5, 2],
        wind: [-0.5, 4],
        changeFrequency: 250,
        opacity: [1, 1],
        zIndex: 99999,
        direction: 'down',
        anchorId: null
      },
      fireflies: {
        snowflakeCount: 400,
        color: '#00fdff',
        radius: [0.1, 4],
        speed: [0.4, 2],
        wind: [-3, 3],
        changeFrequency: 220,
        opacity: [0.1, 1],
        zIndex: 99999,
        direction: 'up',
        anchorId: null
      },
      matrix: {
        snowflakeCount: 900,
        color: '#00f900',
        radius: [1, 2],
        speed: [3, 6],
        wind: [0, 0],
        changeFrequency: 250,
        opacity: [0.1, 3.2],
        zIndex: 99999,
        direction: 'down',
        anchorId: null
      },
      fire: {
        snowflakeCount: 600,
        color: '#ff4b2b',
        radius: [0.2, 3],
        speed: [0.5, 3.5],
        wind: [-0.5, 0.5],
        changeFrequency: 200,
        opacity: [0.3, 2],
        zIndex: 99999,
        direction: 'up',
        anchorId: null
      },
      rain: {
        snowflakeCount: 1000,
        color: '#9ec6ff',
        radius: [0.5, 1],
        speed: [6, 30],
        wind: [-0.1, 0],
        changeFrequency: 250,
        opacity: [0.2, 3],
        zIndex: 99999,
        direction: 'down',
        anchorId: null
      }
    };

    // detect mobile/touch environment
    const isMobile = (() => {
      try {
        const ua = navigator.userAgent || '';
        const isMobileUA = /Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(ua);
        const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints && navigator.maxTouchPoints > 1);
        const small = window.innerWidth <= 720;
        return isMobileUA || (isTouch && small);
      } catch (e) { return false; }
    })();

    // scaling for mobile (reduce particle count and speeds)
    function scalePresetForMobile(preset) {
      if (!isMobile) return preset;
      const scaled = { ...preset };
      scaled.snowflakeCount = Math.max(20, Math.round(preset.snowflakeCount * 0.35));
      scaled.speed = preset.speed.map(v => Math.max(0.1, v * 0.8));
      return scaled;
    }

    // common helpers
    function setIf(id, value) {
      const el = document.getElementById(id);
      if (!el) return;
      el.value = value == null ? '' : String(value);
    }

    function readConfigFromForm() {
      return {
        snowflakeCount: Number(document.getElementById('cfg-snowflakeCount').value) || 0,
        color: document.getElementById('cfg-color').value,
        radius: [Number(document.getElementById('cfg-radius-min').value), Number(document.getElementById('cfg-radius-max').value)],
        speed: [Number(document.getElementById('cfg-speed-min').value), Number(document.getElementById('cfg-speed-max').value)],
        wind: [Number(document.getElementById('cfg-wind-min').value), Number(document.getElementById('cfg-wind-max').value)],
        changeFrequency: Number(document.getElementById('cfg-changeFrequency').value) || 200,
        opacity: [Number(document.getElementById('cfg-opacity-min').value), Number(document.getElementById('cfg-opacity-max').value)],
        zIndex: Number(document.getElementById('cfg-zindex').value) || 99999,
        anchorId: document.getElementById('cfg-anchor-id').value || null,
        direction: document.getElementById('cfg-direction') ? document.getElementById('cfg-direction').value : 'down'
      };
    }

    // create / manage instance
    let snowfall = createSnowfall(readConfigFromForm());
    window.snowfall = snowfall;

    function applyConfigLive() {
      const cfg = readConfigFromForm();
      try { snowfall.destroy(); } catch (e) {}
      snowfall = createSnowfall(cfg);
      window.snowfall = snowfall;
      toggle.textContent = 'Pause';
      updateSnippet(cfg);
    }

    document.querySelectorAll('.controls input, .controls select').forEach(i => i.addEventListener('input', () => applyConfigLive()));
    document.querySelectorAll('.controls input, .controls select').forEach(i => i.addEventListener('change', () => applyConfigLive()));

    // preset application: writes inputs then applies
    function applyPreset(name) {
      const preset = PRESETS[name];
      if (!preset) return;
      const p = scalePresetForMobile(preset);
      const rangeKeys = ['radius','speed','wind','opacity'];
      for (const [k, v] of Object.entries(p)) {
        if (rangeKeys.includes(k) && Array.isArray(v)) {
          setIf(`cfg-${k}-min`, v[0]); setIf(`cfg-${k}-max`, v[1]);
        } else if (k === 'snowflakeCount') setIf('cfg-snowflakeCount', v);
        else if (k === 'color') setIf('cfg-color', v);
        else if (k === 'changeFrequency') setIf('cfg-changeFrequency', v);
        else if (k === 'zIndex') setIf('cfg-zindex', v);
        else if (k === 'anchorId') setIf('cfg-anchor-id', v || '');
        else if (k === 'direction') setIf('cfg-direction', v);
        else setIf(`cfg-${k}`, v);
      }
      applyConfigLive();
    }

    // wire preset buttons
    document.getElementById('preset-snow').addEventListener('click', () => applyPreset('snow'));
    document.getElementById('preset-fireflies').addEventListener('click', () => applyPreset('fireflies'));
    document.getElementById('preset-matrix').addEventListener('click', () => applyPreset('matrix'));
    document.getElementById('preset-fire').addEventListener('click', () => applyPreset('fire'));
    document.getElementById('preset-rain').addEventListener('click', () => applyPreset('rain'));

    const toggle = document.getElementById('toggle');
    const destroy = document.getElementById('destroy');
    const reset = document.getElementById('reset');

    toggle.addEventListener('click', () => {
      if (snowfall.animationFrame) { snowfall.pause(); toggle.textContent = 'Play'; }
      else { snowfall.play(); toggle.textContent = 'Pause'; }
    });

    reset.addEventListener('click', () => {
      const cfg = readConfigFromForm();
      try { snowfall.destroy(); } catch (e) {}
      snowfall = createSnowfall(cfg);
      window.snowfall = snowfall;
      updateSnippet(cfg);
    });

    destroy.addEventListener('click', () => {
      try { snowfall.destroy(); } catch (e) {}
      const cfg2 = readConfigFromForm();
      snowfall = createSnowfall(cfg2);
      window.snowfall = snowfall;
      toggle.textContent = 'Pause';
      updateSnippet(cfg2);
    });

    // snippet
    function updateSnippet(cfg) {
      const parts = [];
      parts.push('import { createSnowfall } from "./snowfall-effect.js";');
      parts.push('');
      parts.push('const snowfall = createSnowfall({');
      parts.push(`  snowflakeCount: ${cfg.snowflakeCount},`);
      parts.push(`  color: '${cfg.color}',`);
      parts.push(`  radius: [${cfg.radius[0]}, ${cfg.radius[1]}],`);
      parts.push(`  speed: [${cfg.speed[0]}, ${cfg.speed[1]}],`);
      parts.push(`  wind: [${cfg.wind[0]}, ${cfg.wind[1]}],`);
      parts.push(`  changeFrequency: ${cfg.changeFrequency},`);
      parts.push(`  opacity: [${cfg.opacity[0]}, ${cfg.opacity[1]}],`);
      if (cfg.zIndex !== undefined) parts.push(`  zIndex: ${cfg.zIndex},`);
      if (cfg.anchorId) parts.push(`  anchorId: '${cfg.anchorId}',`);
      if (cfg.direction) parts.push(`  direction: '${cfg.direction}',`);
      parts.push('});');
      document.getElementById('code-snippet').textContent = parts.join('\n');
    }

    document.getElementById('copy-snippet').addEventListener('click', () => {
      const text = document.getElementById('code-snippet').textContent;
      navigator.clipboard.writeText(text).then(() => {
        const b = document.getElementById('copy-snippet'); b.textContent = 'Copied!'; setTimeout(() => b.textContent = 'Copy Snippet', 1200);
      });
    });

    // initialize snippet and instance state
    updateSnippet(readConfigFromForm());
  </script>
</body>
</html>
